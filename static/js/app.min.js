app.config(["$routeProvider",function(a){a.when("/start",{templateUrl:"/static/page/app/depth.html",controller:"DepthCtrl"}),a.when("/my/list",{templateUrl:"/static/page/app/my_list.html",controller:"MyListCtrl"}),a.when("/files/list",{templateUrl:"/static/page/app/files_list.html",controller:"FilesListCtrl"}),a.when("/domain/list",{templateUrl:"/static/page/app/domain_list.html",controller:"DomainListCtrl"}),a.when("/qq/list",{templateUrl:"/static/page/app/qq_list.html",controller:"QqListCtrl"})}]),app.controller("DepthCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService","$timeout","WebsocketService",function(a,b,c,d,e,f,g,h,i){a.platform={huobi:{name:"火币网",rate:7},bithumb:{name:"韩币网",rate:6e-4}},a.depth={BTC:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},ETH:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},DASH:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},LTC:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},ETC:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},XRP:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},BCH:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},ZEC:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},QTUM:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}},EOS:{huobi:{platform:"huobi",bids:0,asks:0,_bids:0,_asks:0,time:0},bithumb:{platform:"bithumb",bids:0,asks:0,_bids:0,_asks:0,time:0}}},a.profit={BTC:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},ETH:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},DASH:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},LTC:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},ETC:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},XRP:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},BCH:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},ZEC:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},QTUM:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}},EOS:{surplus:{percent:0,money:0},deficit:{percent:0,money:0}}},a.select={mode:[{Id:0,Name:"买卖"},{Id:1,Name:"卖买"}],order:[{Id:0,Name:"手动"},{Id:1,Name:"自动"}]},a.settings={surplus:15,deficit:5,mode:0,order:0,symbol:{BTC:{amount:1,fee:0,cost:0,color:!1},ETH:{amount:1,fee:0,cost:0,color:!1},DASH:{amount:1,fee:0,cost:0,color:!1},LTC:{amount:1,fee:0,cost:0,color:!1},ETC:{amount:1,fee:0,cost:0,color:!1},XRP:{amount:1,fee:0,cost:0,color:!1},BCH:{amount:1,fee:0,cost:0,color:!1},ZEC:{amount:1,fee:0,cost:0,color:!1},QTUM:{amount:1,fee:0,cost:0,color:!1},EOS:{amount:1,fee:0,cost:0,color:!1}}},a.transactionList=[],a.addTransaction=function(b){var c=a.message[b];c.state=1,a.transactionList.unshift(c)},a.message=[],a.$on("10000",function(b,c){var d=angular.fromJson(c);if(!(a.settings.symbol[d.symbol].amount<=0||d.bids==a.depth[d.symbol][d.platform].bids&&d.asks==a.depth[d.symbol][d.platform].asks)){a.depth[d.symbol][d.platform]=d;var e=a.depth[d.symbol].huobi._bids,f=a.depth[d.symbol].huobi._asks,g=a.depth[d.symbol].bithumb._bids,i=a.depth[d.symbol].bithumb._asks;if(0!=e&&0!=e&&0!=g&&0!=i){a.settings.symbol[d.symbol].color=!0,h(function(){a.settings.symbol[d.symbol].color=!1},500),a.profit[d.symbol].surplus.percent=(i-e)/e*100,a.profit[d.symbol].surplus.money=(i-e)*a.settings.symbol[d.symbol].amount,a.profit[d.symbol].deficit.percent=(f-g)/g*100,a.profit[d.symbol].deficit.money=(f-g)*a.settings.symbol[d.symbol].amount;var c={symbol:d.symbol,mode:a.settings.mode,buy:e,sell:i,amount:a.settings.symbol[d.symbol].amount,percent:a.profit[d.symbol].surplus.percent,money:a.profit[d.symbol].surplus.money};a.profit[d.symbol].surplus.percent<a.profit[d.symbol].deficit.percent&&(c.mode="B->A",c.buy=g,c.sell=f,c.buy=g,c.amount=g,c.percent=a.profit[d.symbol].deficit.percent,c.money=a.profit[d.symbol].deficit.money),c.percent>=a.settings.surplus&&a.message.unshift(c)}a.$apply()}})}]),app.controller("DomainEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Domain",Title:"域名",InputType:"text",Required:"true"},{Key:"Sort",Title:"排序",InputType:"text-i",Required:"true",Min:1,Max:100},{Key:"Note",Title:"备注",InputType:"textarea",Required:"false"}],a.title="添加域名",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/domain/add","edit"==e.Op&&(a.title="编辑域名",a.postUrl=f.AppPrefix+"/domain/edit")}]),app.controller("DomainListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService",function(a,b,c,d,e,f,g){a.config=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/domain/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/domain/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"域名删除",text:"确定删除域名“"+d.Name+"“吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/domain/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&(a.getList(),storeService.getList())})})},a.getList()}]),app.controller("FilesEditCtrl",["$sce","$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f,g){if(b.cancel=function(){e.dismiss("cancel")},b.reset=function(){b.editData=angular.copy(b.oldData)},b.change=function(a){if(0==a.length){for(var a in b.editData){if(!b.oldData.hasOwnProperty(a))return!0;if(b.oldData[a]!=b.editData[a])return!0}return!1}return!b.oldData.hasOwnProperty(a)||b.oldData[a]!=b.editData[a]},b.save=function(){c.post(b.postUrl,b.editData).success(function(a,b,c,f){d("CheckError")(a)&&e.close(a)})},b.attrDef=[{Key:"Domain",Title:"域名",InputType:"text",Required:"true"},{Key:"Sort",Title:"排序",InputType:"text-i",Required:"true",Min:1,Max:100},{Key:"Note",Title:"备注",InputType:"text",Required:"false"}],b.title="文件上传",b.op=angular.copy(f.Op),b.oldData=angular.copy(f.Data),b.editData=angular.copy(b.oldData),b.postUrl=g.AppPrefix+"/files/add","edit"==f.Op&&(b.title="编辑文件",b.postUrl=g.AppPrefix+"/files/edit"),"play"==f.Op){b.title=b.oldData.FileName+"--播放测试";var h=encodeURI("http://jdyun.com/?vid="+b.oldData.Key);b.playUrl=a.trustAsResourceUrl("http://123.172.7.3:8200/jx/?url="+h)}}]),app.controller("MyEditCtrl",["$sce","$scope","$http","$filter","$modalInstance","curr_data","appCfg","categoryService",function(a,b,c,d,e,f,g,h){if(b.cancel=function(){e.dismiss("cancel")},b.reset=function(){b.editData=angular.copy(b.oldData)},b.change=function(a){if(0==a.length){for(var a in b.editData){if(!b.oldData.hasOwnProperty(a))return!0;if(b.oldData[a]!=b.editData[a])return!0}return!1}return!b.oldData.hasOwnProperty(a)||b.oldData[a]!=b.editData[a]},b.save=function(){c.post(b.postUrl,b.editData).success(function(a,b,c,f){d("CheckError")(a)&&e.close(a)})},b.attrDef=[{Key:"Name",Title:"文件名",InputType:"text",Required:"true"},{Key:"Category",Title:"分类",InputType:"select",Required:"true",Value:h.data.Items}],b.title="文件上传",b.op=angular.copy(f.Op),b.oldData=angular.copy(f.Data),b.editData=angular.copy(b.oldData),"edit"==f.Op&&(b.title="编辑文件",b.postUrl=g.AppPrefix+"/my/edit"),"play"==f.Op){b.title=b.oldData.FileName+"--播放测试";var i=encodeURI("http://jdyun.com/?vid="+b.oldData.Key);b.playUrl=a.trustAsResourceUrl("http://123.172.7.3:8200/jx/?url="+i)}}]),app.controller("MyListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService","categoryService",function(a,b,c,d,e,f,g,h){a.config=g.data,a.category=h.data,a.search={PageSize:15,Page:1,Keyword:""},a.getList=function(){var d=f.AppPrefix+"/my/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var i;a.add=function(){i=d.open({backdrop:!1,templateUrl:"/static/page/modal/my_add.html?"+version,controller:"MyEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}})},a.edit=function(e){var g=f.AppPrefix+"/my/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(i=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"MyEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),i.result.then(function(b){a.getList()}))})},a.play=function(a){var e=f.AppPrefix+"/my/play/"+a;b.get(e).success(function(a,b,e,f){c("CheckError")(a)&&(i=d.open({backdrop:!1,templateUrl:"/static/page/modal/files_play.html?"+version,controller:"MyEditCtrl",resolve:{curr_data:function(){return{Op:"play",Data:a.Data}}}}))})},a.download=function(a){var d=f.AppPrefix+"/my/download/"+a;b.get(d).success(function(a,b,d,e){c("CheckError")(a)&&(window.location.href=a.Data.DownloadUrl)})},a.activation=function(a){var d=f.AppPrefix+"/my/activation/"+a;b.get(d).success(function(a,b,d,e){c("CheckError")(a)&&alert("激活成功")})},a.del=function(d){e.create({heading:"文件删除",text:"确定删除-“"+d.Name+"“吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/my/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&a.getList()})})},a.getList()}]),app.controller("QqEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Qq",Title:"QQ账号",InputType:"text",Required:"true"},{Key:"Password",Title:"QQ密码",InputType:"text",Required:"true"},{Key:"Cookie",Title:"Cookie",InputType:"textarea",Required:"true"}],a.title="添加QQ小号",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/qq/add","edit"==e.Op&&(a.title="编辑QQ小号",a.postUrl=f.AppPrefix+"/qq/edit")}]),app.controller("QqListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService",function(a,b,c,d,e,f,g){a.config=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/qq/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"QqEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/qq/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"QqEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"QQ小号删除",text:"确定删除“"+d.Qq+"“吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/qq/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&a.getList()})})},a.getList()}]),app.directive("flotChart",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=$.plot(b[0],c,d)}}}]),app.directive("flotChartRealtime",[function(){return{restrict:"A",link:function(a,b){var c,d,e,f,g,h;return c=[],f=500,d=function(){var a,b,d,e;for(c.length>0&&(c=c.slice(1));c.length<f;)b=c.length>0?c[c.length-1]:50,e=b+10*Math.random()-5,0>e?e=0:e>100&&(e=100),c.push(e);for(d=[],a=0;a<c.length;)d.push([a,c[a]]),++a;return d},g=function(){e.setData([d()]),e.draw(),setTimeout(g,h)},c=[],f=500,h=200,e=$.plot(b[0],[d()],{series:{lines:{show:!0,fill:!1},shadowSize:0},yaxis:{min:0,max:100},xaxis:{show:!1},grid:{hoverable:!0,borderWidth:1,borderColor:"#eeeeee"},colors:["#70b1cf"]}),g()}}}]),app.directive("message",["$timeout",function(a){return{restrict:"E",templateUrl:"/static/chat/message.html?"+version,scope:{info:"=",self:"=",language:"=",selectfromuser:"&",selecttouser:"&",scrolltothis:"&",translate:"&"},link:function(b,c,d){b.time=new Date,a(b.scrolltothis)}}}]),app.directive("morrisChart",[function(){return{restrict:"A",scope:{data:"=",type:"=",options:"="},link:function(a,b){var c,d,e,f;switch(c=a.data,f=a.type){case"line":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Line(e);case"area":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Area(e);case"bar":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Bar(e);case"donut":return e=angular.extend({element:b[0],data:c},a.options),e.formatter&&(d=new Function("y","data",e.formatter),e.formatter=d),new Morris.Donut(e)}}}}]),app.directive("sparkline",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=function(){return b.sparkline(c,d)},$(window).resize(function(){var a;return clearTimeout(a),a=setTimeout(e,200)}),e()}}}]),app.directive("zyupload",["$rootScope",function(a){return{restrict:"E",template:'<div id="zyupload" class="zyupload"></div>',link:function(b,c,d){$("#zyupload").zyUpload({width:"100%",height:"100%",itemWidth:"100px",itemHeight:"80px",url:"/admin/album/add",fileType:["jpg","png"],fileSize:512e5,multiple:!0,dragDrop:!1,tailor:!1,del:!0,finishDel:!0,onSelect:function(a,b){console.info("当前选择了以下文件："),console.info(a),console.info("之前没上传的文件："),console.info(b)},onDelete:function(a,b){console.info("当前删除了此文件："),console.info(a),console.info("当前剩余的文件："),console.info(b)},onSuccess:function(b,c){a.$broadcast("uploadSuccess",c),console.info("此文件上传成功："),console.info(b)},onFailure:function(a){console.info("此文件上传失败："),console.info(a)},onComplete:function(b){a.$broadcast("uploadComplete",b),console.info("文件上传完成"),console.info(b)}})}}}]),app.filter("arrayAttr",[function(){return function(a,b,c){for(var d=0;d<b.length;d++)if(b[d].Id==a)return b[d][c];return"无"}}]),app.filter("FileSize",[function(){return function(a){if(0===a)return"0 B";var b=1024;return sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(a)/Math.log(b)),(a/Math.pow(b,i)).toPrecision(3)+" "+sizes[i]}}]),app.service("categoryService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getList=function(){var a=d.AppPrefix+"/apppub/category";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getList()}]),app.service("typeService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getList=function(){var a=d.AppPrefix+"/apppub/type";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getList()}]),app.service("WebsocketService",["$rootScope","LoginService",function(a,b){function c(){g=new WebSocket("ws://"+weburl+"/depth/join"),g.onopen=function(){h=!0},g.onclose=function(){console.log("连接关闭"),h=!1},g.onerror=function(a){for(var b in a)console.log(b+"="+a[b])},g.onmessage=function(b){var c=angular.fromJson(b.data);switch(c.Type){case 0:break;case 1:break;case 2:a.$broadcast("10000",c.Content)}}}function d(a){return h?void g.send(JSON.stringify(a)):void alert("已经断开连接，请从新连接服务器")}var e={EReqLogin:10001,EResLogin:20001,EReqJionRoom:10002,EResJionRoom:20002,EReqLeaveRoom:10003,EResLeaveRoom:20003,EReqChat:10004,EResChat:20004,EReqRoomList:10005,EResRoomList:20005,EReqAddRoom:10006,EResAddRoom:20006,EReqDelRoom:10007,EResDelRoom:20007,EReqUpRoom:10008,EResUpRoom:20008,EReqRoomUserList:10009,EResRoomUserList:20009,EReqUseItem:10011,EResUseItem:20011,EReqFriendList:10013,EResFriendList:20013},f={},g=null,h=!1,i=!1;return c(),f.conn=h,f.reConnectServer=function(){i=!0,g.close(1e3)},f.sendMessage=function(a,b,c){angular.isObject(c)&&(c=angular.toJson(c));var f={Proto:e.EReqChat,Content:angular.toJson({ChatType:a,ToUserId:b,Content:c})};d(f)},f}]);