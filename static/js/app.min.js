app.config(["$routeProvider",function(a){a.when("/start",{templateUrl:"/static/page/app/depth.html",controller:"DepthCtrl"}),a.when("/quanti",{templateUrl:"/static/page/app/quanti.html",controller:"QuantiCtrl"}),a.when("/secret/list",{templateUrl:"/static/page/app/secret_list.html",controller:"SecretListCtrl"}),a.when("/order/list",{templateUrl:"/static/page/app/order_list.html",controller:"OrderListCtrl"})}]),app.controller("DepthCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","PlatformService","SymbolService","$timeout","WebsocketService","BalanceService","SettingsService","OrderService",function(a,b,c,d,e,f,g,h,j,k,l,m,n){a.height=a.windowHeight-90,a.platform=g.data,a.symbol=h.data,a.balance=l.data,a.getBalance=function(){l.getData()},a.order=n.data,a.tab=0,a.active=function(b){a.tab=b},a.depth2={BTC:[],ETH:[],DASH:[],LTC:[],ETC:[],XRP:[],BCH:[],ZEC:[],QTUM:[],EOS:[]},a.upDepth2=function(b){for(var c=-1,d=0;d<a.depth2[b.symbol].length;d++)if(a.depth2[b.symbol][d].platform==b.platform){c=d;break}c>-1?a.depth2[b.symbol][c]=b:a.depth2[b.symbol].push(b)},a.depth={1:{platform:1,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},2:{platform:2,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},3:{platform:3,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},4:{platform:4,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},5:{platform:5,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},6:{platform:6,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},7:{platform:7,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},8:{platform:8,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},9:{platform:4,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}}},a.select={mode:[{Id:1,Name:"买卖"},{Id:2,Name:"卖买"},{Id:3,Name:"同时"}],order:[{Id:1,Name:"手动"},{Id:2,Name:"自动"}],type:[{Id:1,Name:"顺差"},{Id:2,Name:"逆差"}]},a.settings=m.data,a.settingsSave=function(){a.sortList=[],m.save()},a.sortList=[],a.upSort=function(b){for(var c=-1,d=0;d<a.sortList.length;d++)if(a.sortList[d].key==b.key){c=d;break}c>-1?a.sortList[c]=b:a.sortList.push(b)},a.sort="-percent",a.chsrot=function(){a.sort="-percent"==a.sort?"percent":"-percent"},a.filters=1,a.searcha=function(b){return b.platformA==a.filters||2==b.platformA},a.transactionList=[],a.addOrder=function(b,c){var d={index:o++,symbol:b,mode:a.settings.Items.mode,buy:a.depth[b][1]._bids,sell:a.depth[b][2]._asks,amount:a.settings.Items.symbol[b].amount,percent:a.profit[b].surplus.percent,money:a.profit[b].surplus.money,type:1};1==c&&(d.buy=a.depth[b][2]._bids,d.sell=a.depth[b][1]._asks,d.percent=a.profit[b].deficit.percent,d.money=a.profit[b].deficit.money,d.type=2),a.transactionList.push(d)},a.addTransaction=function(b){var c=a.message[b];c.state=1,a.transactionList.push(c)},a.message=[];var o=0;a.$on("10000",function(b,c){var d=angular.fromJson(c);if(d.color={bids:0,asks:0},d._bids=a.settings.Items.rate[d.platform]>0?d.bids*a.settings.Items.rate[d.platform]:d.bids,d._asks=a.settings.Items.rate[d.platform]>0?d.asks*a.settings.Items.rate[d.platform]:d.asks,d.bids!=a.depth[d.platform][d.symbol].bids||d.asks!=a.depth[d.platform][d.symbol].asks){d._bids.toFixed(2)!=a.depth[d.platform][d.symbol]._bids.toFixed(2)&&(d.color.bids=1),d._asks.toFixed(2)!=a.depth[d.platform][d.symbol]._asks.toFixed(2)&&(d.color.asks=1),a.depth[d.platform][d.symbol]=d,a.upDepth2(d);var e=a.depth[d.platform][d.symbol]._bids,f=a.depth[d.platform][d.symbol]._asks,g=e*a.settings.Items.symbol[d.platform][d.symbol].amount,h=f*a.settings.Items.symbol[d.platform][d.symbol].amount,k=g*(a.settings.Items.symbol[d.platform][d.symbol].fee/100),l=h*(a.settings.Items.symbol[d.platform][d.symbol].fee/100),m=f*a.settings.Items.symbol[d.platform][d.symbol].transfer;for(i in a.platform.Items)if(a.platform.Items[i].Id!=d.platform&&0!=a.depth[a.platform.Items[i].Id][d.symbol]._bids){var n=a.depth[a.platform.Items[i].Id][d.symbol]._bids,o=a.depth[a.platform.Items[i].Id][d.symbol]._asks,p=n*a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].amount,q=o*a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].amount,r=p*(a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].fee/100),s=q*(a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].fee/100),t=o*a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].transfer,u=p-h-(r+l+m),v=u/h*100,w=g-q-(k+s+t),x=w/q*100,y={key:d.symbol+"-"+d.platform+"-"+a.platform.Items[i].Id,symbol:d.symbol,platformA:d.platform,platformB:a.platform.Items[i].Id,buy:f,sell:n,money:u,percent:v,timestamp:Date.parse(new Date),msg:""};a.upSort(y);var y={key:d.symbol+"-"+a.platform.Items[i].Id+"-"+d.platform,symbol:d.symbol,platformA:a.platform.Items[i].Id,platformB:d.platform,buy:o,sell:e,money:w,percent:x,timestamp:Date.parse(new Date),msg:""};a.upSort(y)}j(function(){a.depth[d.platform][d.symbol].color.bids=0,a.depth[d.platform][d.symbol].color.asks=0},1e3)}})}]),app.controller("OrderEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Domain",Title:"域名",InputType:"text",Required:"true"},{Key:"Sort",Title:"排序",InputType:"text-i",Required:"true",Min:1,Max:100},{Key:"Note",Title:"备注",InputType:"textarea",Required:"false"}],a.title="添加域名",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/domain/add","edit"==e.Op&&(a.title="编辑域名",a.postUrl=f.AppPrefix+"/domain/edit")}]),app.controller("OrderListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService",function(a,b,c,d,e,f,g){a.config=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/domain/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/domain/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"域名删除",text:"确定删除域名“"+d.Name+"“吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/domain/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&(a.getList(),storeService.getList())})})},a.getList()}]),app.controller("QuantiCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","PlatformService","SymbolService","$timeout","WebsocketService","BalanceService","SettingsService","OrderService",function(a,b,c,d,e,f,g,h,j,k,l,m,n){a.height=a.windowHeight-100,a.platform=g.data,a.symbol=h.data,a.balance=l.data,a.getBalance=function(){l.getData()},a.order=n.data,a.tab=0,a.active=function(b){a.tab=b},a.depth2={BTC:[],ETH:[],DASH:[],LTC:[],ETC:[],XRP:[],BCH:[],ZEC:[],QTUM:[],EOS:[]},a.upDepth2=function(b){for(var c=-1,d=0;d<a.depth2[b.symbol].length;d++)if(a.depth2[b.symbol][d].platform==b.platform){c=d;break}c>-1?a.depth2[b.symbol][c]=b:a.depth2[b.symbol].push(b)},a.depth={1:{platform:1,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},2:{platform:2,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},3:{platform:3,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},4:{platform:4,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},5:{platform:5,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},6:{platform:6,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},7:{platform:7,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},8:{platform:8,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}},9:{platform:4,color:!1,BTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETH:{bids:0,asks:0,_bids:0,_asks:0,time:0},DASH:{bids:0,asks:0,_bids:0,_asks:0,time:0},LTC:{bids:0,asks:0,_bids:0,_asks:0,time:0},ETC:{bids:0,asks:0,_bids:0,_asks:0,time:0},XRP:{bids:0,asks:0,_bids:0,_asks:0,time:0},BCH:{bids:0,asks:0,_bids:0,_asks:0,time:0},ZEC:{bids:0,asks:0,_bids:0,_asks:0,time:0},QTUM:{bids:0,asks:0,_bids:0,_asks:0,time:0},EOS:{bids:0,asks:0,_bids:0,_asks:0,time:0}}},a.select={mode:[{Id:1,Name:"买卖"},{Id:2,Name:"卖买"},{Id:3,Name:"同时"}],order:[{Id:1,Name:"手动"},{Id:2,Name:"自动"}],type:[{Id:1,Name:"顺差"},{Id:2,Name:"逆差"}]},a.settings=m.data,a.settingsSave=function(){a.sortList=[],m.save()},a.sortList=[],a.upSort=function(b){for(var c=-1,d=0;d<a.sortList.length;d++)if(a.sortList[d].key==b.key){c=d;break}c>-1?a.sortList[c]=b:a.sortList.push(b)},a.sort="-percent",a.chsrot=function(){a.sort="-percent"==a.sort?"percent":"-percent"},a.filters=1,a.searcha=function(b){return b.platformA==a.filters||2==b.platformA},a.transactionList=[],a.addOrder=function(b,c){var d={index:o++,symbol:b,mode:a.settings.Items.mode,buy:a.depth[b][1]._bids,sell:a.depth[b][2]._asks,amount:a.settings.Items.symbol[b].amount,percent:a.profit[b].surplus.percent,money:a.profit[b].surplus.money,type:1};1==c&&(d.buy=a.depth[b][2]._bids,d.sell=a.depth[b][1]._asks,d.percent=a.profit[b].deficit.percent,d.money=a.profit[b].deficit.money,d.type=2),a.transactionList.push(d)},a.addTransaction=function(b){var c=a.message[b];c.state=1,a.transactionList.push(c)},a.message=[];var o=0;a.$on("10000",function(b,c){var d=angular.fromJson(c);if(d.color={bids:0,asks:0},d._bids=a.settings.Items.rate[d.platform]>0?d.bids*a.settings.Items.rate[d.platform]:d.bids,d._asks=a.settings.Items.rate[d.platform]>0?d.asks*a.settings.Items.rate[d.platform]:d.asks,d.bids!=a.depth[d.platform][d.symbol].bids||d.asks!=a.depth[d.platform][d.symbol].asks){d._bids.toFixed(2)!=a.depth[d.platform][d.symbol]._bids.toFixed(2)&&(d.color.bids=1),d._asks.toFixed(2)!=a.depth[d.platform][d.symbol]._asks.toFixed(2)&&(d.color.asks=1),a.depth[d.platform][d.symbol]=d,a.upDepth2(d);var e=a.depth[d.platform][d.symbol]._bids,f=a.depth[d.platform][d.symbol]._asks,g=e*a.settings.Items.symbol[d.platform][d.symbol].amount,h=f*a.settings.Items.symbol[d.platform][d.symbol].amount,k=g*(a.settings.Items.symbol[d.platform][d.symbol].fee/100),l=h*(a.settings.Items.symbol[d.platform][d.symbol].fee/100),m=f*a.settings.Items.symbol[d.platform][d.symbol].transfer;for(i in a.platform.Items)if(a.platform.Items[i].Id!=d.platform&&0!=a.depth[a.platform.Items[i].Id][d.symbol]._bids){var n=a.depth[a.platform.Items[i].Id][d.symbol]._bids,o=a.depth[a.platform.Items[i].Id][d.symbol]._asks,p=n*a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].amount,q=o*a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].amount,r=p*(a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].fee/100),s=q*(a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].fee/100),t=o*a.settings.Items.symbol[a.platform.Items[i].Id][d.symbol].transfer,u=p-h-(r+l+m),v=u/h*100,w=g-q-(k+s+t),x=w/q*100,y={key:d.symbol+"-"+d.platform+"-"+a.platform.Items[i].Id,symbol:d.symbol,platformA:d.platform,platformB:a.platform.Items[i].Id,buy:f,sell:n,money:u,percent:v,timestamp:Date.parse(new Date),msg:""};a.upSort(y);var y={key:d.symbol+"-"+a.platform.Items[i].Id+"-"+d.platform,symbol:d.symbol,platformA:a.platform.Items[i].Id,platformB:d.platform,buy:o,sell:e,money:w,percent:x,timestamp:Date.parse(new Date),msg:""};a.upSort(y)}j(function(){a.depth[d.platform][d.symbol].color.bids=0,a.depth[d.platform][d.symbol].color.asks=0},1e3)}})}]),app.controller("SecretEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg","PlatformService",function(a,b,c,d,e,f,g){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Pid",Title:"平台类型",InputType:"select",Required:"true",Value:g.data.Items},{Key:"AccessKey",Title:"AccessKey",InputType:"text",Required:"true"},{Key:"SecretKey",Title:"SecretKey",InputType:"text",Required:"true"}],a.title="添加平台秘钥",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/secret/add","edit"==e.Op&&(a.title="编辑平台秘钥",a.postUrl=f.AppPrefix+"/secret/edit")}]),app.controller("SecretListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","PlatformService",function(a,b,c,d,e,f,g){a.platform=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/secret/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"SecretEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/secret/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"SecretEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"秘钥删除",text:"确定删除吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/secret/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&a.getList()})})},a.getList()}]),app.directive("flotChart",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=$.plot(b[0],c,d)}}}]),app.directive("flotChartRealtime",[function(){return{restrict:"A",link:function(a,b){var c,d,e,f,g,h;return c=[],f=500,d=function(){var a,b,d,e;for(c.length>0&&(c=c.slice(1));c.length<f;)b=c.length>0?c[c.length-1]:50,e=b+10*Math.random()-5,0>e?e=0:e>100&&(e=100),c.push(e);for(d=[],a=0;a<c.length;)d.push([a,c[a]]),++a;return d},g=function(){e.setData([d()]),e.draw(),setTimeout(g,h)},c=[],f=500,h=200,e=$.plot(b[0],[d()],{series:{lines:{show:!0,fill:!1},shadowSize:0},yaxis:{min:0,max:100},xaxis:{show:!1},grid:{hoverable:!0,borderWidth:1,borderColor:"#eeeeee"},colors:["#70b1cf"]}),g()}}}]),app.directive("message",["$timeout",function(a){return{restrict:"E",templateUrl:"/static/chat/message.html?"+version,scope:{info:"=",self:"=",language:"=",selectfromuser:"&",selecttouser:"&",scrolltothis:"&",translate:"&"},link:function(b,c,d){b.time=new Date,a(b.scrolltothis)}}}]),app.directive("morrisChart",[function(){return{restrict:"A",scope:{data:"=",type:"=",options:"="},link:function(a,b){var c,d,e,f;switch(c=a.data,f=a.type){case"line":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Line(e);case"area":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Area(e);case"bar":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Bar(e);case"donut":return e=angular.extend({element:b[0],data:c},a.options),e.formatter&&(d=new Function("y","data",e.formatter),e.formatter=d),new Morris.Donut(e)}}}}]),app.directive("resize",["$window",function(a){return function(b,c){var d=angular.element(a);b.getWindowDimensions=function(){return{h:d.height(),w:d.width()}},b.$watch(b.getWindowDimensions,function(a,c){b.windowHeight=a.h,b.windowWidth=a.w},!0),d.bind("resize",function(){b.$apply()})}}]),app.directive("rightClick",["$parse",function(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}]),app.directive("sparkline",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=function(){return b.sparkline(c,d)},$(window).resize(function(){var a;return clearTimeout(a),a=setTimeout(e,200)}),e()}}}]),app.directive("zyupload",["$rootScope",function(a){return{restrict:"E",template:'<div id="zyupload" class="zyupload"></div>',link:function(b,c,d){$("#zyupload").zyUpload({width:"100%",height:"100%",itemWidth:"100px",itemHeight:"80px",url:"/admin/album/add",fileType:["jpg","png"],fileSize:512e5,multiple:!0,dragDrop:!1,tailor:!1,del:!0,finishDel:!0,onSelect:function(a,b){console.info("当前选择了以下文件："),console.info(a),console.info("之前没上传的文件："),console.info(b)},onDelete:function(a,b){console.info("当前删除了此文件："),console.info(a),console.info("当前剩余的文件："),console.info(b)},onSuccess:function(b,c){a.$broadcast("uploadSuccess",c),console.info("此文件上传成功："),console.info(b)},onFailure:function(a){console.info("此文件上传失败："),console.info(a)},onComplete:function(b){a.$broadcast("uploadComplete",b),console.info("文件上传完成"),console.info(b)}})}}}]),app.filter("arrayAttr",[function(){return function(a,b,c){for(var d=0;d<b.length;d++)if(b[d].Id==a)return b[d][c];return"无"}}]),app.filter("FileSize",[function(){return function(a){if(0===a)return"0 B";var b=1024;return sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(a)/Math.log(b)),(a/Math.pow(b,i)).toPrecision(3)+" "+sizes[i]}}]),app.filter("search",[function(){return function(a,b){var c=[],d=Date.parse(new Date),e=6e4;return angular.isDefined(b)&&(e=1e3*b.expired),angular.forEach(a,function(a){d-a.timestamp<e&&angular.isDefined(b.symbol[a.symbol])&&b.symbol[a.symbol]&&angular.isDefined(b.platformA[a.platformA])&&b.platformA[a.platformA]&&angular.isDefined(b.platformB[a.platformB])&&b.platformB[a.platformB]&&(a.msg=((d-a.timestamp)/1e3).toFixed(0)+" 秒前",c.push(a))}),c}}]),app.service("BalanceService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:{}},this.getData=function(){e.data.Items={};var a=d.AppPrefix+"/api/balance";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getData()}]),app.service("OrderService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getList=function(){var a=d.AppPrefix+"/order/list";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getList()}]),app.service("PlatformService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getData=function(){var a=d.AppPrefix+"/apppub/platform";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getData()}]),app.service("SettingsService",["$rootScope","$http","$filter","appCfg","EzConfirm",function(a,b,c,d,e){var f=this;this.data={Items:{}},this.getData=function(){var a=d.AppPrefix+"/settings/view";b.get(a).success(function(a,b,d,e){if(c("CheckError")(a)){for(var g=angular.fromJson(a.Data),h=1;h<=9;h++)angular.isUndefined(g.rate[h])&&(g.rate[h]=1),angular.isUndefined(g.symbol[h])&&(g.symbol[h]={BTC:{fee:.2,transfer:.001,amount:.3},ETH:{fee:.2,transfer:.001,amount:.3},DASH:{fee:.2,transfer:.001,amount:.3},LTC:{fee:.2,transfer:.001,amount:.3},ETC:{fee:.2,transfer:.001,amount:.3},XRP:{fee:.2,transfer:.001,amount:.3},BCH:{fee:.2,transfer:.001,amount:.3},ZEC:{fee:.2,transfer:.001,amount:.3},QTUM:{fee:.2,transfer:.001,amount:.3},EOS:{fee:.2,transfer:.001,amount:.3}});f.data.Items=g}}).error(function(a,b,c,d){})},this.save=function(){var a=d.AppPrefix+"/settings/edit",g={Data:angular.toJson(f.data.Items)};b.post(a,g).success(function(a,b,d,f){c("CheckError")(a)&&e.create({heading:"系统提示",text:"操作成功",cancelBtn:"",confirmBtn:"知道了"})})},this.getData()}]),app.service("SymbolService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getData=function(){var a=d.AppPrefix+"/apppub/symbol";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getData()}]),app.service("WebsocketService",["$rootScope","$filter",function(a,b){function c(){f=new WebSocket("ws://"+weburl+"/depth/join"),f.onopen=function(){g=!0},f.onclose=function(){b("AlertError")("与服务器断开连接，尝试刷新页面重新连接"),g=!1},f.onerror=function(a){for(var b in a)console.log(b+"="+a[b])},f.onmessage=function(b){var c=angular.fromJson(b.data);switch(c.Type){case 0:break;case 1:break;case 2:a.$broadcast("10000",c.Content)}}}function d(a){return g?void f.send(JSON.stringify(a)):void alert("已经断开连接，请从新连接服务器")}var e={},f=null,g=!1,h=!1;return setTimeout(function(){console.log("开始连接"),c()},1e3),e.conn=g,e.reConnectServer=function(){h=!0,f.close(1e3)},e.sendMessage=function(a,b,c){angular.isObject(c)&&(c=angular.toJson(c));var e={Proto:10002,Content:angular.toJson({ChatType:a,ToUserId:b,Content:c})};d(e)},e}]);