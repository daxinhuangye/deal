app.config(["$routeProvider",function(a){a.when("/start",{templateUrl:"/static/page/app/depth.html",controller:"DepthCtrl"}),a.when("/secret/list",{templateUrl:"/static/page/app/secret_list.html",controller:"SecretListCtrl"}),a.when("/order/list",{templateUrl:"/static/page/app/order_list.html",controller:"OrderListCtrl"})}]),app.controller("DepthCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","PlatformService","$timeout","WebsocketService","BalanceService","SettingsService","OrderService",function(a,b,c,d,e,f,g,h,j,k,l,m){a.height=a.windowHeight-100,a.platform=g.data,a.balance=k.data,a.getBalance=function(){k.getData()},a.order=m.data,a.tab=0,a.active=function(b){a.tab=b},a.depth={BTC:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},ETH:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},DASH:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},LTC:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},ETC:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},XRP:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},BCH:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},ZEC:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},QTUM:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}},EOS:{1:{platform:1,bids:0,asks:0,_bids:0,_asks:0,time:0},2:{platform:2,bids:0,asks:0,_bids:0,_asks:0,time:0},3:{platform:3,bids:0,asks:0,_bids:0,_asks:0,time:0}}},a.profit={BTC:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},ETH:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},DASH:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},LTC:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},ETC:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},XRP:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},BCH:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},ZEC:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},QTUM:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}},EOS:{surplus:{percent:0,money:0,formula:""},deficit:{percent:0,money:0,formula:""}}},a.select={mode:[{Id:1,Name:"买卖"},{Id:2,Name:"卖买"},{Id:3,Name:"同时"}],order:[{Id:1,Name:"手动"},{Id:2,Name:"自动"}],type:[{Id:1,Name:"顺差"},{Id:2,Name:"逆差"}]},a.settings=l.data,a.settingsSave=function(){l.save(a.settings.Items)},a.sortList=[],a.upSort=function(b,c,d){for(var e=-1,f=0;f<a.sortList.length;f++)if(a.sortList[f].symbol==b){e=f;break}var g={symbol:b,surplus:c,deficit:d};e>=0?a.sortList[e]=g:a.sortList.push(g)},a.transactionList=[],a.addOrder=function(b,c){var d={index:n++,symbol:b,mode:a.settings.Items.mode,buy:a.depth[b][1]._bids,sell:a.depth[b][2]._asks,amount:a.settings.Items.symbol[b].amount,percent:a.profit[b].surplus.percent,money:a.profit[b].surplus.money,type:1};1==c&&(d.buy=a.depth[b][2]._bids,d.sell=a.depth[b][1]._asks,d.percent=a.profit[b].deficit.percent,d.money=a.profit[b].deficit.money,d.type=2),a.transactionList.push(d)},a.addTransaction=function(b){var c=a.message[b];c.state=1,a.transactionList.push(c)},a.message=[];var n=0;a.$on("10000",function(b,c){var d=angular.fromJson(c);if(!(a.settings.Items.symbol[d.symbol].amount<=0||d.bids==a.depth[d.symbol][d.platform].bids&&d.asks==a.depth[d.symbol][d.platform].asks)){a.depth[d.symbol][d.platform]=d,a.depth[d.symbol][d.platform]._bids=a.depth[d.symbol][d.platform].bids*a.settings.Items.rate[d.platform],a.depth[d.symbol][d.platform]._asks=a.depth[d.symbol][d.platform].asks*a.settings.Items.rate[d.platform];for(i in a.depth[d.symbol])for(i in a.depth[d.symbol]);var e=a.depth[d.symbol][1]._bids,f=a.depth[d.symbol][1]._asks,g=a.depth[d.symbol][2]._bids,j=a.depth[d.symbol][2]._asks,k=e*a.settings.Items.symbol[d.symbol].amount,l=f*a.settings.Items.symbol[d.symbol].amount,m=g*a.settings.Items.symbol[d.symbol].amount,o=j*a.settings.Items.symbol[d.symbol].amount,p=k*(a.settings.Items.symbol[d.symbol].fee[1][0]/100),q=l*(a.settings.Items.symbol[d.symbol].fee[1][0]/100),r=m*(a.settings.Items.symbol[d.symbol].fee[2][0]/100),s=o*(a.settings.Items.symbol[d.symbol].fee[2][0]/100),t=f*a.settings.Items.symbol[d.symbol].fee[1][1],u=j*a.settings.Items.symbol[d.symbol].fee[2][1];if(0!=e&&0!=e&&0!=g&&0!=j){if(a.settings.Items.symbol[d.symbol].color=!0,h(function(){a.settings.Items.symbol[d.symbol].color=!1},1e3),a.profit[d.symbol].surplus.money=m-l-r-q-t,a.profit[d.symbol].surplus.percent=a.profit[d.symbol].surplus.money/l*100,a.profit[d.symbol].surplus.formula=m+"-"+l+"-"+r+"-"+q+"-"+t,a.profit[d.symbol].deficit.money=k-o-p-s-u,a.profit[d.symbol].deficit.percent=a.profit[d.symbol].deficit.money/o*100,a.profit[d.symbol].deficit.formula=k+"-"+o+"-"+p+"-"+s+"-"+u,a.upSort(d.symbol,a.profit[d.symbol].surplus.percent,a.profit[d.symbol].deficit.percent),a.profit[d.symbol].surplus.percent<a.settings.surplus&&a.profit[d.symbol].deficit.percent<a.settings.surplus)return;var c={index:n++,symbol:d.symbol,mode:a.settings.Items.mode,buy:f,sell:g,amount:a.settings.Items.symbol[d.symbol].amount,percent:a.profit[d.symbol].surplus.percent,money:a.profit[d.symbol].surplus.money,type:1};a.profit[d.symbol].deficit.percent>=a.settings.deficit&&(c.buy=j,c.sell=e,c.percent=a.profit[d.symbol].deficit.percent,c.money=a.profit[d.symbol].deficit.money,c.type=2)}a.$apply()}})}]),app.controller("OrderEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Domain",Title:"域名",InputType:"text",Required:"true"},{Key:"Sort",Title:"排序",InputType:"text-i",Required:"true",Min:1,Max:100},{Key:"Note",Title:"备注",InputType:"textarea",Required:"false"}],a.title="添加域名",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/domain/add","edit"==e.Op&&(a.title="编辑域名",a.postUrl=f.AppPrefix+"/domain/edit")}]),app.controller("OrderListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService",function(a,b,c,d,e,f,g){a.config=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/domain/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/domain/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"域名删除",text:"确定删除域名“"+d.Name+"“吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/domain/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&(a.getList(),storeService.getList())})})},a.getList()}]),app.controller("SecretEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg","PlatformService",function(a,b,c,d,e,f,g){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Pid",Title:"平台类型",InputType:"select",Required:"true",Value:g.data.Items},{Key:"AccessKey",Title:"AccessKey",InputType:"text",Required:"true"},{Key:"SecretKey",Title:"SecretKey",InputType:"text",Required:"true"}],a.title="添加平台秘钥",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/secret/add","edit"==e.Op&&(a.title="编辑平台秘钥",a.postUrl=f.AppPrefix+"/secret/edit")}]),app.controller("SecretListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","PlatformService",function(a,b,c,d,e,f,g){a.platform=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/secret/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"SecretEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/secret/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"SecretEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"秘钥删除",text:"确定删除吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/secret/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&a.getList()})})},a.getList()}]),app.directive("flotChart",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=$.plot(b[0],c,d)}}}]),app.directive("flotChartRealtime",[function(){return{restrict:"A",link:function(a,b){var c,d,e,f,g,h;return c=[],f=500,d=function(){var a,b,d,e;for(c.length>0&&(c=c.slice(1));c.length<f;)b=c.length>0?c[c.length-1]:50,e=b+10*Math.random()-5,0>e?e=0:e>100&&(e=100),c.push(e);for(d=[],a=0;a<c.length;)d.push([a,c[a]]),++a;return d},g=function(){e.setData([d()]),e.draw(),setTimeout(g,h)},c=[],f=500,h=200,e=$.plot(b[0],[d()],{series:{lines:{show:!0,fill:!1},shadowSize:0},yaxis:{min:0,max:100},xaxis:{show:!1},grid:{hoverable:!0,borderWidth:1,borderColor:"#eeeeee"},colors:["#70b1cf"]}),g()}}}]),app.directive("message",["$timeout",function(a){return{restrict:"E",templateUrl:"/static/chat/message.html?"+version,scope:{info:"=",self:"=",language:"=",selectfromuser:"&",selecttouser:"&",scrolltothis:"&",translate:"&"},link:function(b,c,d){b.time=new Date,a(b.scrolltothis)}}}]),app.directive("morrisChart",[function(){return{restrict:"A",scope:{data:"=",type:"=",options:"="},link:function(a,b){var c,d,e,f;switch(c=a.data,f=a.type){case"line":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Line(e);case"area":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Area(e);case"bar":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Bar(e);case"donut":return e=angular.extend({element:b[0],data:c},a.options),e.formatter&&(d=new Function("y","data",e.formatter),e.formatter=d),new Morris.Donut(e)}}}}]),app.directive("resize",["$window",function(a){return function(b,c){var d=angular.element(a);b.getWindowDimensions=function(){return{h:d.height(),w:d.width()}},b.$watch(b.getWindowDimensions,function(a,c){b.windowHeight=a.h,b.windowWidth=a.w},!0),d.bind("resize",function(){b.$apply()})}}]),app.directive("rightClick",["$parse",function(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}]),app.directive("sparkline",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=function(){return b.sparkline(c,d)},$(window).resize(function(){var a;return clearTimeout(a),a=setTimeout(e,200)}),e()}}}]),app.directive("zyupload",["$rootScope",function(a){return{restrict:"E",template:'<div id="zyupload" class="zyupload"></div>',link:function(b,c,d){$("#zyupload").zyUpload({width:"100%",height:"100%",itemWidth:"100px",itemHeight:"80px",url:"/admin/album/add",fileType:["jpg","png"],fileSize:512e5,multiple:!0,dragDrop:!1,tailor:!1,del:!0,finishDel:!0,onSelect:function(a,b){console.info("当前选择了以下文件："),console.info(a),console.info("之前没上传的文件："),console.info(b)},onDelete:function(a,b){console.info("当前删除了此文件："),console.info(a),console.info("当前剩余的文件："),console.info(b)},onSuccess:function(b,c){a.$broadcast("uploadSuccess",c),console.info("此文件上传成功："),console.info(b)},onFailure:function(a){console.info("此文件上传失败："),console.info(a)},onComplete:function(b){a.$broadcast("uploadComplete",b),console.info("文件上传完成"),console.info(b)}})}}}]),app.filter("arrayAttr",[function(){return function(a,b,c){for(var d=0;d<b.length;d++)if(b[d].Id==a)return b[d][c];return"无"}}]),app.filter("FileSize",[function(){return function(a){if(0===a)return"0 B";var b=1024;return sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(a)/Math.log(b)),(a/Math.pow(b,i)).toPrecision(3)+" "+sizes[i]}}]),app.service("BalanceService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:{}},this.getData=function(){e.data.Items={};var a=d.AppPrefix+"/api/balance";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getData()}]),app.service("OrderService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getList=function(){var a=d.AppPrefix+"/order/list";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getList()}]),app.service("PlatformService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getData=function(){var a=d.AppPrefix+"/apppub/platform";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getData()}]),app.service("SettingsService",["$rootScope","$http","$filter","appCfg","EzConfirm",function(a,b,c,d,e){var f=this;this.data={Items:{}},this.getData=function(){var a=d.AppPrefix+"/settings/view";b.get(a).success(function(a,b,d,e){c("CheckError")(a)&&(f.data.Items=angular.fromJson(a.Data))}).error(function(a,b,c,d){})},this.save=function(){var a=d.AppPrefix+"/settings/edit",g={Data:angular.toJson(f.data.Items)};b.post(a,g).success(function(a,b,d,f){c("CheckError")(a)&&e.create({heading:"系统提示",text:"操作成功",cancelBtn:"",confirmBtn:"知道了"})})},this.getData()}]),app.service("WebsocketService",["$rootScope",function(a){function b(){e=new WebSocket("ws://"+weburl+"/depth/join"),e.onopen=function(){f=!0},e.onclose=function(){console.log("连接关闭"),f=!1},e.onerror=function(a){for(var b in a)console.log(b+"="+a[b])},e.onmessage=function(b){var c=angular.fromJson(b.data);switch(c.Type){case 0:break;case 1:break;case 2:a.$broadcast("10000",c.Content)}}}function c(a){return f?void e.send(JSON.stringify(a)):void alert("已经断开连接，请从新连接服务器")}var d={},e=null,f=!1,g=!1;return setTimeout(function(){console.log("开始连接"),b()},1e3),d.conn=f,d.reConnectServer=function(){g=!0,e.close(1e3)},d.sendMessage=function(a,b,d){angular.isObject(d)&&(d=angular.toJson(d));var e={Proto:10002,Content:angular.toJson({ChatType:a,ToUserId:b,Content:d})};c(e)},d}]);